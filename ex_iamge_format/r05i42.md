# 画像フォーマット レポート

* 実験日：2025年01月23日
* 実験者：2I44 吉髙 僚眞

## 実験目的
* 画像の保存形式には BMP, JPEG などがある。ここでは BMP 形式を例にファイルフォーマットの基礎を学ぶ。

## 実験1 フォーマットの理解
1. モノクロBMPにおいて、ピクセル数から画像データサイズを求め、ファイル内の値と一致することを確かめよ。
   * 横ピクセル数 `1F` → 31pix 
   * 縦ピクセル数 `14` → 20pix
   * 横ピクセル数は一番近い4の倍数として計算するので、
     * 32 × 20 = 640 bit
   * 画像データサイズ `50` → 80byte = 640bit
    
    →一致している

2. カラーBMP 例(color.bmp)において、ピクセル数から画像データサイズを求め、ファイル内の値と一致することを確かめよ。
   * 横ピクセル数 `37` → 55pix
   * 縦ピクセル数 `3E` → 62pix
   * 横ピクセル数は一番近い4の倍数として計算するので、
     * 56 * 62 * (カラー24bit) = 833,328 bit
   * 画像データサイズ `28 B0` → 10416byte = 83,328 bit

    → 一致している

3.  カラーBMP 例(color.bmp)において、どのピクセルからどの方向にデータが格納されているか調べよ。（ヒント、画像データの最初の数ビットを黒色に変えてみよ）
   * バリナリの画像データの先頭から数バイトを黒に変更したところ、画像の左下から右に向かってデータが保存されていることがわかった。
   * 同様にバイナリの最後から数バイトを黒に変更したところ、画像の右上から左に向かって色が変化したことがわかった。
   * つまり、以下のような順で保存されていることがわかる。
     ````
     BCDEF
     6789A
     12345
     ````
    
## 実験2 画像データの修復
1. bmp1.bmp は横ピクセル数の値が間違っている。修復して画像を表示しなさい。
   * モノクロ画像であることが1C~1Dを読み取るとわかるので以下のように考える。
   * 元画像の縦ピクセル数 `20` → 32
   * 画像データサイズ `02 00` →　512byte = 4096bit
   * ```横ピクセル数 × 縦ピクセル数 = 画像データサイズ(bit)``` となるので
   * 本来の横ピクセル数は 4096 / 32 = 128 よって `80`に変更すればよい

2. bmp2.bmp は縦ピクセル数の値が間違っている。修復して画像を表示しなさい。
   * カラー(24bit)画像であることが1C~1Dを読み取るとわかるので以下のように考える。
   * 元画像の横ピクセル数 `A6` → 166
   * 画像データサイズ `01 0F 7C` →　69,500byte = 556,000bit
   * ```横ピクセル数 × 縦ピクセル数 × カラービット数 = 画像データサイズ(bit)``` となるので
   * また、横ピクセル数は一番近い4の倍数として計算するので、
   * 本来の横ピクセル数は 556,000 / (166 × 24) = 139.55 .=・139 よって `8B`に変更すればよい

3.  bmp3.bmp はダブルクリックしても「このファイルは読み取れません」とエラーになってしまう。修復して画像を表示しなさい。
    * bmp3.bmpファイルのファイルタイプを示すアドレス(00~01)を見ると、`42 4E` = BNとなっていることがわかる。
    * ビットマップ形式のファイルタイプは`42 4D` = BMとしなくてはならないのでそのように修正する。
  
1. JPEG, PNG, GIF, TIFF のシグネチャを調べなさい。
    * JPEG
      * 先頭2byteが`FF D8`となり、JPEGの開始を表す 
    * PNG
      * 先頭4byteが`89 50 4e 47`となり、2~4byteが`PNG`を表す。
    * GIF
      * 先頭の3byteの`47 49 46`が`GIF`を表す。
    * TIFF
      * 先頭の2byteが`00 2A`となる。
  
2. 誤って拡張子を消してしまった。gazou1,gzou2 の拡張子を修復しなさい。
   
   **gazou1**
   
   * 先頭2byteが`FF D8`となっているため、JPEG形式のファイルと考えられる。
   * `gazou1.jpg`に変更する

   **gazou2**

   * 先頭3byteが`47 49 46`となっているため、GIF形式のファイルだと考えられる
   * `gazou1.gif`に変更する

## 考察1
> Windows には拡張子が存在する。どんな目的で使用されているのだろうか。

どんなファイルの種類・形式か識別する目的で使用されている。拡張子を使用して識別することで、拡張子と紐づけてアプリを起動できるようにしたり、拡張子ごとにアイコンを設定したりするのに役立っている。

## 考察2
> 拡張子は必要か。自分の考えを述べなさい。

私は拡張子は必要であると考える。ファイルを識別するだけなら今回やったようにシグネチャを見ればどんな形式であるかを把握することができるが、画像以外にもファイルの種類・形式が無数にあること増えていくと16進数での表記が基本となるシグネチャで判断することは難しくなっていくだろう。しかし、拡張子はファイル名の後ろにある文字を認識して、どんな形式のファイルかわかるため、人も機械もより簡単にファイルの形式を判断できる。